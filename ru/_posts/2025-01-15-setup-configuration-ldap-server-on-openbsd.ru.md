---
title: Простая настройка и конфигурирование сервера LDAP на OpenBSD
date: "2025-01-15 11:00:00 +0300"
id: setup-configuration-ldap-server-on-openbsd.ru
lang: ru
tags: "ldap, openldap, server, freebsd, database"
excerpt: "LDAP (Lightweight Directory Access Protocol) — стандартный метод, используемый для доступа к данным в базе данных."
keywords: openldap, ldap, freebsd, server, openbsd, configuration, setup
---

Допустим, у вас есть несколько учетных записей пользователей, которые вы хотите синхронизировать между несколькими системами и другими службами приложений. Как это сделать? Возможно ли это вообще? Чтобы ответить на эти вопросы, вы можете использовать Ansible/Puppet/Chef или более продвинутые скрипты. Или мы можем решить эту проблему и объединить системы и службы в одном месте. Это место — LDAP!.

LDAP (Lightweight Directory Access Protocol) — это стандартный метод, используемый для доступа к данным в базах данных. Хотя LDAP на самом деле не является базой данных. Что именно представляет собой база данных? В этой статье мы не будем обсуждать базы данных. Хотя есть много причин, по которым вы не захотите использовать LDAP, одним из аргументов в пользу его использования является то, что почти любая служба, в которой вы хотите пройти аутентификацию, может взаимодействовать с сервером LDAP.

В этом руководстве мы расскажем вам, как установить OpenLDAP на OpenBSD. OpenLDAP — это программный пакет с открытым исходным кодом, предоставляющий службы каталогов, аналогичные Microsoft Active Directory. OpenLDAP — это легкая, безопасная и масштабируемая служба каталогов, которую можно использовать для управления учетными записями пользователей и контроля доступа к приложениям.

## 1. Подготовка
Первое, что необходимо сделать, это подготовить сервер и базу данных. И первое, что нужно сделать в настройке сервера — это указать доменное имя. В этой статье мы будем использовать общеупотребимое доменное имя «example.com».

В первой части мы импортируем схему, которая будет использоваться. Схема в LDAP похожа на определение таблицы/столбца в SQL. Схема сообщает LDAP-серверу, какие столбцы могут существовать, как идентифицировать и обрабатывать каждый столбец (чувствителен ли он к регистру, может ли он повторяться и т. д.). Приведенная ниже схема является схемой по умолчанию, включенной в операционную систему OpenBSD. При необходимости вы также можете добавить дополнительные схемы.

schema "/etc/ldap/core.schema"
schema "/etc/ldap/inetorgperson.schema"
schema "/etc/ldap/nis.schema"
schema "/etc/ldap/bsd.schema"

Далее мы определим интерфейс, который будет использовать LDAP. В этой статье LDAP будет прослушивать интерфейс обратной связи и отмечать его как безопасный. Это позволяет нам проводить аутентификацию с помощью простого текстового пароля. (Это может быть полезно для тестирования) Мы также будем прослушивать внешний интерфейс, в данном примере vio0, и при необходимости потребуем LDAPS.

listen on lo0 secure
listen on "/var/run/ldapi"
listen on vio0 ldaps certificate <hostname>

В приведенном выше примере скрипта LDAP требует сертификат. Мы предполагаем, что сертификаты хранятся в каталоге /etc/ldap/certs. Убедитесь, что каталог недоступен для чтения ни группе, ни кому-либо другому. Если сертификат уже есть в /etc/ssl, то можно создать простую символическую ссылку на сертификат и ключ.

```
foo# chmod 700 /etc/ldap/certs
foo# ln -s /etc/ssl/<hostname>.crt /etc/ldap/certs/<hostname>.crt
foo# ln -s /etc/ssl/private/<hostname>.key /etc/ldap/certs/<hostname>.key
```

Следующий шаг — нам нужно место для хранения информации. Нам нужно «создать» базу данных. Вот некоторые важные вещи, на которые следует обратить внимание:

А) Мы указываем домен в формате LDAP, используя синтаксис dc=example,dc=com. Со временем ввод этого текста станет очень утомительным. К счастью, у меня есть несколько сценариев, которые могут помочь.

Б) Пароль rootpw может быть открытым текстом, но это не обязательно. Использование скрипта salted_passwd.sh создаст для вас соленый хэш SHA1.

```
foo# salted_passwd.sh
enter password (will not echo): letmein
{SSHA}vpeFJlj9iz/2UqQ0eGcU9PzeP/lyVG1VQWV3Qg==
```

```
namespace "dc=example,dc=com" {
        rootdn          "cn=admin,dc=example,dc=com"
        rootpw          "{SSHA}vpeFJlj9iz/2UqQ0eGcU9PzeP/lyVG1VQWV3Qg=="
        index           sn
        index           givenName
        index           cn
        index           mail
        index           ou
}
```

## 2. Процесс установки OpenLDAP
Откройте окно терминала и введите следующую команду для установки OpenLDAP в OpenBSD:

```
foo# pkg_add openldap-server
```

После загрузки пакета система попросит вас ответить на несколько вопросов по конфигурации. Параметры по умолчанию должны подойти для большинства случаев. Вы можете нажать Enter, чтобы выбрать вариант ответа по умолчанию для каждого вопроса.

Если вам позже потребуется изменить конфигурацию, вы можете использовать следующую команду:

```
foo# nano /etc/openldap/slapd.conf
```

## 3. Запуск OpenLDAP
Чтобы запустить сервер OpenLDAP в OpenBSD, выполните следующую команду.

```
foo# /etc/rc.d/slapd start
```

Чтобы остановить сервер OpenLDAP, используйте следующую команду.

```
foo# /etc/rc.d/slapd stop
```

Чтобы перезапустить сервер OpenLDAP, используйте следующую команду.

```
foo# /etc/rc.d/slapd restart
```

Чтобы проверить, установлен ли OpenLDAP и работает ли он должным образом, используйте следующую команду для проверки состояния сервера OpenLDAP.

```
foo# ldapctl status
```

Вы также можете протестировать установку, создав нового пользователя в базе данных OpenLDAP. Для создания нового пользователя используйте следующую команду.

```
foo# ldapadd -x -D "cn=admin,dc=example,dc=com" -W -f /usr/local/share/examples/openldap/ldif/user.ldif
```

Если вы дочитали до этого места, спасибо за прочтение моей статьи. Надеюсь, вы сможете настроить простой LDAP-сервер, позволяющий объединить учетные записи пользователей в одном месте.
