---
title: "Установка и настройка FreeBSD Lighttpd Plus Mod OpenSSL"
date: 2024-09-27 16:00:00+03:00
excerpt: "Lighttpd очень надежен в высокопроизводительных средах с небольшим объемом памяти по сравнению с другими веб-серверами и служит для эффективного управления загрузкой ЦП расширенного набора функций, таких как SCGI, сжатие вывода, аутентификация, FastCGI, перезапись URL."
id: freebsd-lighttpd-mod-openssl
lang: ru
layout: single
categories:
  - FreeBSD
tags: "lighttpd, freebsd, httpd, openbsd, configuration, mod, openssl, http, https, ssl"
keywords: apache, freebsd, mod, openbsd, configuration, setup, openssl, http, https, ssl
---

Этот веб-сервер, распространяемый по лицензии BSD, является одним из самых легких, безопасных и быстрых веб-серверов. Lighttpd очень надежен в высокопроизводительных средах с небольшим объемом памяти по сравнению с другими веб-серверами и служит для эффективного управления загрузкой ЦП расширенного набора функций, таких как SCGI, сжатие вывода, аутентификация, FastCGI, перезапись URL и многие другие.

Для пользователей, испытывающих нагрузку при работе с веб-сервером, Lighttpd является идеальным решением для серверов, испытывающих проблемы с рабочей нагрузкой. Lighttpd — отличная альтернатива широко используемым веб-серверам Nginx и Apache. Потому что Lighttpd — это легкий веб-сервер с открытым исходным кодом, оптимизированный для высокоскоростных сред и низкого потребления ресурсов, что снижает производительность ЦП.

Что касается процесса веб-сервера, вы, должно быть, знаете, что некоторые сайты обрабатывают тысячи файлов параллельно, поэтому требуется большой объем памяти, а максимальное количество потоков или процессов также велико.

Чтобы решить эту проблему, Дэн Кегель подробно описал проблемы с обработкой тысяч одновременных запросов на своей странице, посвященной проблемам C10K. В 2003 году немецкий разработчик MySQL по имени Ян Кнешке заинтересовался этой проблемой и решил, что он сможет написать более быстрый веб-сервер, чем Apache, сосредоточившись на правильных методах.

Затем Ян Кнешке разработал lighttpd как единый процесс с одним потоком и неблокируемым вводом-выводом. Lighttpd также использует самый быстрый обработчик событий в целевой системе: polling, epoll, kqueue или /dev/polling. Lighttpd предпочитает неподключенные системные вызовы, такие как sendfile, вместо чтения и записи. Результатом его усилий стало то, что через несколько месяцев lighttpd начал обрабатывать статические файлы быстрее, чем Apache.

В этой статье вы узнаете, как установить и настроить Lighttpd на сервере FreeBSD. Мало того, для повышения безопасности веб-сервера Lighttp мы также добавили режим Openssl в содержание этой статьи.

# Технические характеристики системы

ОС: FreeBSD 13.2 Стабильная
Имя хоста: ns5
IP-адрес: 192.168.5.2
Домен: datainchi.com
Версия Lighttpd: lighttpd/1.4.67 (ssl) - легкий и быстрый веб-сервер

## А. Процесс установки Lighttpd

Как вы знаете, на серверах FreeBSD существует два способа установки каждого приложения, а именно система портов и пакет PKG. Специально для установок Lighttp мы предпочитаем использовать систему портов, поскольку она может собирать все библиотеки, необходимые Lighttpd.

Перед началом процесса установки Lighttpd необходимо сначала установить зависимости Lighttpd, а именно «Зависимости сборки» и «Зависимости библиотеки». Вот как установить эти зависимости.

```
root@ns5:~ # pkg install cmake-core ninja pkgconf
```

Приведенная выше команда используется для установки «Зависимостей сборки». Теперь установим «Библиотечные зависимости», которые будет использовать Lighttpd.

```
root@ns5:~ # pkg install pcre2 nettle lua54
```

Мы установили все зависимости, давайте продолжим установку Lighttpd.

```
root@ns5:~ # cd /usr/ports/www/lighttpd
root@ns5:/usr/ports/www/lighttpd # make config
```

В команде «make config» необходимо включить некоторые параметры, поскольку мы будем использовать мод OpenSSL, включите параметр «OPENSSL».

Используйте команду «make install clean», чтобы начать процесс установки.

```
root@ns5:/usr/ports/www/lighttpd # make install clean
```

## B. Создать Start Up rc.d

Вы, конечно, не хотите, чтобы каждое приложение запускалось вручную. Что бы произошло, если бы Lighttpd запускался вручную? Конечно, это было бы очень хлопотно. Вот как автоматически запустить Lighttpd на вашем сервере FreeBSD.

В Linux есть systemd для автоматического запуска приложений, а во FreeBSD — rc.d. Чтобы Lihttpd запускался автоматически, откройте файл «/etc/rc/conf» и введите в него следующую команду.

```
lighttpd_enable="YES"
lighttpd_conf="/usr/local/etc/lighttpd/lighttpd.conf"
lighttpd_pidfile="/var/run/lighttpd.pid"
lighttpd_instances=""
```

В приведенном выше скрипте файл конфигурации Lighttpd находится в папке «/usr/local/etc/lighttpd» с именем файла конфигурации «lighttpd.conf».

Вы можете запустить Lighttpd с помощью следующей команды.

```
root@ns5:~ # service lighttpd restart
```

## C. Конфигурация Lighttpd

Основной файл конфигурации Lighttpd — «/usr/local/etc/lighttpd/lighttpd.conf», вы открываете этот файл и редактируете только те скрипты, которые вам нужны. Чтобы включить частные порты и IP-адреса, запустите скрипт ниже.

```
server.port = 80
server.use-ipv6 = "disable"
server.bind = "192.168.5.2"
server.username  = "www"
server.groupname = "www"
server.document-root = "/usr/local/www" + "/data"
server.pid-file = state_dir + "/lighttpd.pid"
```

Для тех из вас, кто только начинает работать с Lighttpd, конфигурация «журнала» важна, поскольку часто что-то выходит из строя или Lighttpd не запускается из-за неправильной конфигурации «журнала». Для настройки «log» следуйте приведенному ниже сценарию.

```
server.errorlog-use-syslog = "enable"
include conf_dir + "/conf.d/debug.conf"
```

Приведенная выше конфигурация журнала предоставит LightTPD привилегии для управления собственными журналами.

Часто при запуске LightTPD появляется сообщение об ошибке, подобное следующему.

2024-01-15 10:31:51: (configfile.c.1287) ПРЕДУПРЕЖДЕНИЕ: неизвестный config-key: dir-listing.encoding (игнорируется)
2024-01-15 10:31:51: (configfile.c.1287) ПРЕДУПРЕЖДЕНИЕ: неизвестный config-key: dir-listing.exclude (игнорируется)

Чтобы обойти эту проблему, вы можете включить опцию «dir-listing.activate» в файле «/usr/local/etc/lighttpd/lighttpd.conf».

```
include conf_dir + "/conf.d/dirlisting.conf"
dir-listing.activate = "enable"
```

Теперь вы используете Lighttpd.

```
root@ns5:~ # service lighttpd restart
Performing sanity check on lighttpd configuration:
Stopping lighttpd.
Waiting for PIDS: 12730.
Starting lighttpd.
```

Полный скрипт для файла "/usr/local/etc/lighttpd/lighttpd.conf" можно увидеть на Github unixwinbsd.

Все данные Lighttpd хранятся в папке «/usr/local/www/data». Создайте файл index.html и введите скрипт, который вы скачали на Github unixwinbsd.

```
root@ns5:~ # cd /usr/local/www
root@ns5:/usr/local/www # mkdir -p data
root@ns5:/usr/local/www # cd data
root@ns5:/usr/local/www/data # touch index.html
root@ns5:/usr/local/www/data # chown -R www:www /usr/local/www/data/
```

## D. Создать Openssl Mod

Основная функция шифрования — преобразование обычных текстовых сообщений в зашифрованный текст, который не может быть прочитан посторонними лицами. Все конфиденциальные данные пользователя, такие как учетные данные для входа и личная информация, шифруются перед отправкой по сети. После этого доступ к веб-сайту смогут получить только получатели, имеющие правильный ключ дешифрования.

В целом, на веб-серверах используются два основных протокола шифрования, а именно:
- SSL: протокол защищенных сокетов.
- TLS: Transport Layer Security (замена SSL).

Lighttpd также обладает весьма продвинутыми возможностями шифрования. Существует множество способов шифрования веб-сервера. В этой статье мы обсуждаем только шифрование с помощью OpenSSL.

На первом этапе мы сгенерируем закрытые ключи и CSR. Мы сохраним закрытый ключ и файлы CSR в каталоге FreeBSD, а именно /etc/ssl. Включите каталог и выполните команду ниже.

```
root@ns5:~ # cd /etc/ssl
root@ns5:/etc/ssl # openssl genrsa -out /etc/ssl/unixwinbsd.key 4096
Generating RSA private key, 4096 bit long modulus (2 primes)
....................................................................................................................................................++++
.........................++++
e is 65537 (0x010001)
```

Для большей безопасности установите ограниченные права доступа к файлам на уровне 400 или 600.

```
root@ns5:/etc/ssl # chmod 400 /etc/ssl/unixwinbsd.key
```

Следующим шагом является создание файла .csr, который содержит необходимые сведения о домене/организации вашего веб-сайта.

```
root@ns5:/etc/ssl # openssl req -new -sha256 -key /etc/ssl/unixwinbsd.key -out /etc/ssl/unixwinbsd.csr
```

Подпишите свой CSR-файл.

```
root@ns5:/etc/ssl # openssl x509 -req -days 365 -in unixwinbsd.csr -signkey unixwinbsd.key -out unixwinbsd.crt
Signature ok
```

Объедините первичный сертификат, промежуточный сертификат и закрытый ключ в один.

```
root@ns5:/etc/ssl # cat unixwinbsd.crt unixwinbsd.key > unixwinbsd-ssl.pem
```

После успешного создания SSL-сертификата отредактируйте файл конфигурации Lighttpd, который называется «/usr/local/etc/lighttpd/lighttpd.conf».

Введите скрипт ниже, чтобы включить OpenSSL в Lighttpd.

```
server.modules += ( "mod_openssl" )
ssl.pemfile = "/etc/ssl/unixwinbsd-ssl.pem"

   $SERVER["socket"] == "*:443" {
     ssl.engine  = "enable"
   }
```

## E. Тест Lighttpd

В качестве последнего шага в приведенной выше конфигурации мы проводим тест, сначала запуская веб-сервер Lighttpd с помощью следующей команды.

```
root@ns5:/etc/ssl # service lighttpd restart
```

Если при выполнении команды выше возникает ошибка в файле SSL, поскольку Lighttpd часто медленно реагирует на созданный вами файл SSL, чтобы избежать этого, вы можете повторить команду.

```
root@ns5:/etc/ssl # openssl x509 -req -days 365 -in unixwinbsd.csr -signkey unixwinbsd.key -out unixwinbsd.crt
root@ns5:/etc/ssl # cat unixwinbsd.crt unixwinbsd.key > unixwinbsd-ssl.pem
```

Теперь откройте веб-браузер Google Chrome, в адресной строке введите «http://192.168.5.2» или «https://192.168.5.2».

В заключение следует отметить, что Lighttpd — это легкий, эффективный, надежный и универсальный веб-сервер, который выделяется среди многих других программных средств веб-серверов, таких как NGINX и Apache. Его событийно-ориентированная архитектура, расширенные функции и ориентация на безопасность делают его отличным выбором для обслуживания веб-контента в различных средах.



