---
title: Настройка файла crontab в OpenBSD
date: "2022-02-11 19:00:00 +0300"
id: setup-crontab-file-openbsd
excerpt: "Активная строка в файле crontab — это настройка переменной среды или команды cron. Настройка переменной среды в файле crontab создаст среду, в которой будет выполняться любая команда в crontab."
mathjax: true
lang: ru
layout: single
categories:
  - OpenBSD
keywords: cront, scheduling, freebsd, openbsd, aria2, download, file
tags: "cron, crontab, file, schedule, time, openbsd, freebsd"
---

Файл crontab — это файл, содержащий инструкции для демона cron(8). Команды в любом файле crontab будут выполняться либо от имени пользователя, которому принадлежит crontab, либо, в случае системного crontab, от имени пользователя, указанного в командной строке. Хотя crontab — это текстовый файл, он не предназначен для непосредственного редактирования. Создание, изменение и удаление файлов crontab необходимо выполнять с помощью [crontab(1).](https://man.openbsd.org/crontab.1)

Активные строки в файле crontab — это настройки переменных среды или команды cron. Установка переменных среды в файле crontab создаст среду, в которой будут выполняться все команды в crontab.

В системах OpenBSD файл crontab активируется не сразу. Вам необходимо включить файл crontab, чтобы он мог работать в соответствии с данными вами инструкциями. По умолчанию в системах OpenBSD файл crontab находится в /etc/crontab.

## A. Краткий обзор файлов Crontab

Чтобы облегчить понимание файлов crontab, мы немного объясним их. Файл Crontab — это команда Unix, которая создает таблицу или список команд, каждая из которых будет выполнена операционной системой (ОС) в определенное время и в соответствии с указанным вами расписанием. Файл crontab используется для создания файла crontab (списка), а затем используется для изменения ранее созданного файла crontab.

Crontab (сокращение от cron table) — это файл, содержащий расписание различных записей cron, которые должны быть запущены в определенное время. Другой способ описать crontab — это утилита, которая позволяет автоматически запускать задачи через заданные интервалы времени в фоновом режиме с помощью демона cron (см. ниже).

Файл crontab содержит простые инструкции для демона, которые означают «запустить эту команду в определенное время и в определенную дату». Инструкции Crontab указывают, какие команды следует запускать, в какую дату и в какое время.

С помощью этой утилиты пользователям будет проще запускать скрипты или [команды OpenBSD](https://www.inchimediatama.org/2025/01/freebsd-cara-membuat-sistem-pencatatan-log.html) в определенное время и с определенными интервалами. Эта утилита идеально подходит для повторяющихся задач, таких как обслуживание системы, резервное копирование и обновления.

## B. Как создать файл Crontab

Как мы уже обсуждали выше, для запуска crontab его необходимо включить. В этом разделе мы создадим файл crontab и включим его в системе OpenBSD.

Чтобы создать файл crontab, выполните следующую команду.

```
ns2# touch /etc/crontab
ns2# chown root:wheel /etc/crontab
ns2# chmod 0600 /etc/crontab
```

После создания файла crontab вы можете ввести в него скрипт cron. В качестве примера ниже мы приводим скрипт из файла /etc/crontab.

```
#	$OpenBSD: crontab,v 1.28 2020/04/18 17:22:43 jmc Exp $
#
# /var/cron/tabs/root - root's crontab
#
SHELL=/bin/sh
PATH=/bin:/sbin:/usr/bin:/usr/sbin
HOME=/var/log
#
#minute	hour	mday	month	wday	[flags] command
#
# rotate log files every hour, if necessary
0	*	*	*	*	/usr/bin/newsyslog
# send log file notifications, if necessary
#1-59	*	*	*	*	/usr/bin/newsyslog -m
#
# do daily/weekly/monthly maintenance
30	1	*	*	*	/bin/sh /etc/daily
30	3	*	*	6	/bin/sh /etc/weekly
30	5	1	*	*	/bin/sh /etc/monthly
#~	*	*	*	*	/usr/libexec/spamd-setup

#~	*	*	*	*	-ns rpki-client -v && bgpctl reload
```

Чтобы еще раз пояснить, как использовать скрипт crontab, приведем пример. Вот пример, в котором мы хотим загружать файл br.zone каждого 12-го числа месяца, и это делается в 5:00 утра.

```
# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
0 5 12 * * root wget --no-check-certificate https://www.ipdeny.com/ipblocks/data/countries/br.zone -O /etc/tables/br.zone
```

Чтобы увидеть активность загрузки файла br.zone, вы можете просмотреть файл журнала с помощью следующей команды.

```
ns2# tail -f /var/cron/log
```

## C. Что вам нужно знать о файлах Crontab

Прежде чем двигаться дальше, необходимо знать несколько вещей о настройке файла /etc/crontab:
- Файлы журналов: Расположение файлов журналов для crontab — «/var/cron/log». Этот файл полезен для отслеживания правильности выполнения команд.
- Время получения изменений файла: cron проверяет время изменения в системном файле crontab каждую минуту.
- Режим файла: Файл crontab будет проигнорирован, если у него неправильный режим файла. Режим должен быть 0600. Файл не должен быть доступен для записи пользователям, отличным от root, и в нем не должны быть установлены биты выполнения, установки идентификатора пользователя, установки идентификатора группы или биты закрепления.
- Перезапустите cron: чтобы перезагрузить файл cron, выполните команду «/etc/rc.d/cron restart».
- В качестве альтернативы мы можем использовать файл /var/cron/tabs/root для настройки файла crontab на корневом уровне.

## D. Синтаксис файла Crontab

Файл crontab — это встроенный инструмент автоматизации, позволяющий пользователям OpenBSD управлять планированием задач. Каждый пользователь может иметь отдельный файл crontab, содержащий несколько заданий cronjob, которые будут периодически выполняться демоном cron.

Ниже представлен синтаксис crontab, который можно использовать при работе с файлами crontab.

crontab [-u (for user)]
crontab [-e (edit)]
crontab [-l (list)]
crontab [-r (hapus)]

Пример его использования вы можете увидеть ниже.

```
ns2# crontab -u root /etc/crontab
ns2# crontab -e
ns2# crontab -l
ns2# crontab -r
```

Чтобы включить crontab, можно использовать команду restart.

```
ns2# /etc/rc.d/cron restart
```

Хотя файл crontab по умолчанию не активен в OpenBSD, его следует включить, чтобы можно было автоматизировать все демоны, работающие с файлом crontab. Особенно это касается демонов, которые запускаются многократно, например, обновление IP-адреса демона ddclient и других.
