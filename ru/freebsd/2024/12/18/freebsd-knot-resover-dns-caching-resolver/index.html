<!doctype html>
<html lang="ru">
  <head>
    <meta http-equiv="Content-Language" content="en">
<link rel="alternate" hreflang="en" href="https://penaadventure.com/ru/freebsd/2024/12/18/freebsd-knot-resover-dns-caching-resolver/"/>

  <meta charset="utf-8">
  
  <title>FreeBSD Knot Resolver — реализация DNS Caching Resolver  UnixBSDShell</title>
  <meta property="og:locale" content="en">
  <meta property="og:site_name" content="UnixBSDShell">
  <meta property="og:title" content="FreeBSD Knot Resolver — реализация DNS Caching Resolver"><link rel="canonical" href="https://penaadventure.com/ru/freebsd/2024/12/18/freebsd-knot-resover-dns-caching-resolver/">
  <meta property="og:url" content="https://penaadventure.com/ru/freebsd/2024/12/18/freebsd-knot-resover-dns-caching-resolver/"><meta property="og:description" content="Knot DNS Resolver включает в себя полное приложение для реализации кэш-резолвера, написанное на LuaJIT и C."><meta name="twitter:site" content="@iwanset96143401">
  <meta name="twitter:title" content="FreeBSD Knot Resolver — реализация DNS Caching Resolver">
  <meta name="twitter:description" content="Knot DNS Resolver включает в себя полное приложение для реализации кэш-резолвера, написанное на LuaJIT и C.">
  <meta name="twitter:url" content="https://penaadventure.com/ru/freebsd/2024/12/18/freebsd-knot-resover-dns-caching-resolver/"><meta name="twitter:card" content="summary"><meta property="og:type" content="article">
  <meta property="article:published_time" content="2024-12-18T19:00:00+03:00"><script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "",
      "url" : "https://penaadventure.com",
      "sameAs" : null
    }
  </script><meta name="google-site-verification" content="googledc9be5e5382da4fd" /><meta name="msvalidate.01" content="BCDF1444D895EBA62C6422C90DF8EA1C"><meta name="yandex-verification" content="69d778baa1dbd371">
  <link href="feed.xml" type="application/atom+xml" rel="alternate" title="UnixBSDShellFeed" />
  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script>
    document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  </script>
  <!-- For all browsers -->
  <link rel="stylesheet" href="https://penaadventure.com/assets/css/main.css" />
  <meta http-equiv="cleartype" content="on" />    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#000000" />
    <meta name="apple-mobile-web-app-title" content="JHW Blog" />
    <meta name="application-name" content="JHW Blog" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="fediverse:creator" content="@jwildeboer@social.wildeboer.net" /><script type='text/javascript' src='//timdinosaur.com/5a/a1/16/5aa1163b15793d4f19e80dbdf2135e99.js'></script>

  <meta http-equiv="Content-Language" content="en">
<meta name="verified-code" content="7e9546f3-7a9d-4d82-b8b4-d8e51e2c6c17">
  <link rel="alternate" hreflang="en" href="https://penaadventure.com/ru/freebsd/2024/12/18/freebsd-knot-resover-dns-caching-resolver/" />
  
<link rel="alternate" hreflang="en" href="https://penaadventure.com/en" />
<link rel="alternate" hreflang="ru" href="https://penaadventure.com/ru" />

  </head>
  <body class="layout--single">  <!--[if lt IE 9]>
  <div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
  <![endif]--><div class="masthead">
    <div class="masthead__inner-wrap">
      <div class="masthead__menu">
        <nav id="site-nav" class="greedy-nav">
          <ul class="visible-links">
            <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://penaadventure.com/">UnixBSDShell</a></li><li class="masthead__menu-item"><a href="https://penaadventure.com/about/">Me</a></li><li class="masthead__menu-item"><a href="https://penaadventure.com/year-archive/">By Year</a></li><li class="masthead__menu-item"><a href="https://penaadventure.com/categories/">Categories</a></li><li class="masthead__menu-item"><a href="https://penaadventure.com/tags/">Tags</a></li></ul>
          <ul class="hidden-links hidden"></ul>
        </nav>
      </div>
    </div>
  </div>



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://penaadventure.com/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#ru" itemprop="item"><span itemprop="name">Ru</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#freebsd" itemprop="item"><span itemprop="name">Freebsd</span></a>
          <meta itemprop="position" content="3" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#2024" itemprop="item"><span itemprop="name">2024</span></a>
          <meta itemprop="position" content="4" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#12" itemprop="item"><span itemprop="name">12</span></a>
          <meta itemprop="position" content="5" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#18" itemprop="item"><span itemprop="name">18</span></a>
          <meta itemprop="position" content="6" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">FreeBSD Knot Resolver — реализация DNS Caching Resolver</li>
      
    
  </ol>
</nav>
<script type="application/ld+json">

{"@context":"https://schema.org",

"@graph":[

{"@type":"ProfilePage",
"@id": "https://penaadventure.com/#profilepage",
"name": {"name":"UnixBSDShell's Blog","avatar":"auth/JHW500.jpg","avataralt":"Thank you for visiting our site. Have a nice day!.","bio":"penaadventure.com is an online learning platform that provides online tutorials and videos about unix, FreeBSD, OpenBSD and Linux. Not only that, penaadventure.com also presents a variety of topics, including software development, programming, web design, and more. This blog provides various online tutorials and videos for beginners and experienced professionals. This blog also provides a Q&A forum for users to ask questions and get help from other members.","location":"Moscow, Russia"},
"url": "https://penaadventure.com/about-us",
"relatedLink": "httpss://www.github.com/unixbsdshell",
"dateCreated": "2024-12-18 19:00:00 +0300",
"datePublished": "2024-12-18 19:00:00 +0300",
"abstract": "WARNET DAPURNET leverages open-source Linux to provide educational services in Cikarang Barat, Indonesia.",

"mainEntity":[
{"@type":"Person",
"@id": "https://penaadventure.com/#person",
"name": {"name":"UnixBSDShell's Blog","avatar":"auth/JHW500.jpg","avataralt":"Thank you for visiting our site. Have a nice day!.","bio":"penaadventure.com is an online learning platform that provides online tutorials and videos about unix, FreeBSD, OpenBSD and Linux. Not only that, penaadventure.com also presents a variety of topics, including software development, programming, web design, and more. This blog provides various online tutorials and videos for beginners and experienced professionals. This blog also provides a Q&A forum for users to ask questions and get help from other members.","location":"Moscow, Russia"},
"url": "https://penaadventure.com/about-us",
"gender": "male",
"description": "Lahir di Bekasi - Jawa Barat, seorang anak laki-laki yang mendedikasikan dirinya untuk menulis berbagai artikel tentang IT.",
"alternateName": "Iwan Sting",
"additionalName": "setiawan",
"givenName": "Bata",
"familyName": "Om Iwan",
"birthDate": "1977",
"birthPlace": "Kabupaten Bekasi, Provinsi Jawa Barat, Indonesia",
"jobTitle": "Blogger Writer",
"spouse": "Siti Umaroh",  

"homeLocation": 
{ "@type": "Place",
"image": "https://lh3.googleusercontent.com/vLqLiGPo6QmAaoml2wwECAjBD_ZMivRMpakTpgCkGf-foAn3SjzMtxi-9CYKJf8aM1Zgxm8-fgpA8ar4=s265-w265-h265",
"url": "https://lh3.googleusercontent.com/vLqLiGPo6QmAaoml2wwECAjBD_ZMivRMpakTpgCkGf-foAn3SjzMtxi-9CYKJf8aM1Zgxm8-fgpA8ar4=s265-w265-h265",
"hasMap": "https://www.google.com/maps/place/WARNET+DAPURNET/@-6.2697727,107.1165375,17z/data=!3m1!4b1!4m6!3m5!1s0x2e69854270602ca7:0x71e63dfb53b7b95!8m2!3d-6.2697727!4d107.1165375!16s%2Fg%2F11fx88pw2p?entry=ttu",
"photo": "https://maps.app.goo.gl/5e3jR7dbtUypBe2Q8",
"name": "MyHome",
"description": "Dari tugu Warung Bongkok sebelum Pom Bensin/10 mtr arah timur dari tugu bambu runcing/Belakang RM. Padang Selera Bunda",
"identifier": "Tugu Bambu Runcing Warung bongkok"},
"address": {"@type": "PostalAddress",
"addressLocality": "Jawa Barat, Indonesia",
"addressRegion": "Jawa Barat",
"postalCode": "17841",
"telephone": "+62 812 8906 5249",
"email": "datainchi@gmail.com",
"streetAddress": "Jl. Raya Imam Bonjol No.86, Telagamurni, Kec. Cikarang Bar., Kabupaten Bekasi, Jawa Barat 17841"},

"image": {"@type": "ImageObject",
"width": "32",
"height": "32",
"url": "https://lh3.googleusercontent.com/a/ACg8ocINT1yW-xPXQuI4Qku0LW5-QNI-26KpzLWO9_DrPDQWSVJ8gQtu=s288-c-no"}

},

{"@context": "http://schema.org",
"@type": "EducationalOrganization",
"@id": "https://penaadventure.com/#organization",
"url": "https://www.inchimediatama.org/p/organization.html",
"identifier": "https://www.google.com/maps/place/WARNET+DAPURNET/@-6.2697727,107.1139626,17z/data=!3m1!4b1!4m6!3m5!1s0x2e69854270602ca7:0x71e63dfb53b7b95!8m2!3d-6.2697727!4d107.1165375!16s%2Fg%2F11fx88pw2p?entry=ttu/#2425380976366117670",
"name": "Inchimediatama Nusantara",
"foundingDate": "2009",
"slogan": "FreeBSD The Power To Serve",
"knowsAbout": "Tutorials UNIX BSD Linux Windows Opensource",
"knowsLanguage": ["id","en"],
"legalName" : "Inchimediatama Nusantara",
"image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgz6JYLaq1_DkQMs0yJBpGZZve00P5m-7HPxrRIYhDdVng6kHfmZc4x9EW_vI0DyspmFsWtcMenBJzfaummNCefFmTdZr5c8M1IL9l2sufVKbaSVEQs-0feAUpmCkDu4Eo-1rCR60XZ66Ym5BFLYe2dnPHWRHqRp4-OpmJE56J9Z-zhvg/s1600/logo%20unixwinbsd.png",      
"logo": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhRDo6ylljwvU7hLVWRd9cIciBEO4sknBzOHQGECuvW5x8ZK6LuFj890M6HCZZM9j61NaqQU3DA1_SJZELqdtiIEdUejC9zkIf_lLDFFgR3dXAQ2l2lqadxk0waF_lYet5olTZX19oEbYHYJSMaBScwIACW1pGs3TtnR7ZCu7P_FqmzX61yUasXjXmPdC6l/s320/Logo%20Inchi%20copy.png",
"address": {"@type": "PostalAddress",
"addressLocality": "Jawa Barat, Indonesia",
"addressRegion": "Jawa Barat",
"addressCountry": "ID",
"postalCode": "17841",
"telephone": "+62 812 8906 5249",
"email": "datainchi@gmail.com",
"streetAddress": "Jl. Raya Imam Bonjol No.86, Telagamurni, Kec. Cikarang Bar., Kabupaten Bekasi, Jawa Barat 17841"},
"location": 
{"@type": "Place",
"geo": {"@type": "GeoCoordinates",
"latitude": "-6.2697727", "longitude": "107.1165375"}
}
}
],

"image":{"@type":"ImageObject",
"@id":"https://penaadventure.com/#logo",
"url": "https://penaadventure.com/img/logo.png",
"caption":"Inchimediatama Nusantara"}


},

{

"@type":"WebSite",
"@id":"https://penaadventure.com/#website",
"url": "https://penaadventure.com",
"inLanguage":"ru",
"name": "UnixBSDShell",
"publisher":{"@id": "https://penaadventure.com/#organization"},
"potentialAction":{"@type":"SearchAction",
"target":"https://penaadventure.com/?s={search_term_string}",
"query-input":"required name=search_term_string"}
},



{"@type":"WebPage",
"@id":"https://penaadventure.com/#webpage",
"url": "https://penaadventure.com",
"inLanguage":"ru",
"name": "FreeBSD Knot Resolver — реализация DNS Caching Resolver",
"isPartOf":
{"@id":"https://penaadventure.com/#website"},

"image": {
"@type": "ImageObject",
"@id":"https://penaadventure.com/#image",
"width": "1200",
"height": "630",
"url": "https://penaadventure.com",
"caption": "Knot DNS Resolver включает в себя полное приложение для реализации кэш-резолвера, написанное на LuaJIT и C."
},

"datePublished": "2024-12-18 19:00:00 +0300",
"dateModified": "2024-12-18 19:00:00 +0300",
"description": "UnixBSDShell",

"breadcrumb":
{"@id":"https://penaadventure.com/#breadcrumb"}
},

{
"@type":"BreadcrumbList",
"@id":"https://penaadventure.com/#breadcrumb",
"itemListElement":[
{"@type":"ListItem",
"position":1,
"item":{"@type":"WebPage",
"@id":"https://penaadventure.com/",
"url": "https://penaadventure.com",
"name": "UnixBSDShell"
}},

{
"@type":"ListItem",
"position":2,
"item":{"@type":"WebPage",
"@id":"https://penaadventure.com/",
"url": "https://penaadventure.com/ru/freebsd/2024/12/18/freebsd-knot-resover-dns-caching-resolver/",
"name": "FreeBSD Knot Resolver — реализация DNS Caching Resolver"
}},

{

"@type":"ListItem",
"position":3,
"item":{"@type":"WebPage",
"url": "https://penaadventure.com/ru/freebsd/2024/12/18/freebsd-knot-resover-dns-caching-resolver/",
"name": "DNSServer"
}}

]},



{  "@type": "BlogPosting",
  "url": "https://penaadventure.com/ru/freebsd/2024/12/18/freebsd-knot-resover-dns-caching-resolver/",
  "name": "FreeBSD Knot Resolver — реализация DNS Caching Resolver",
  "headline": "FreeBSD Knot Resolver — реализация DNS Caching Resolver",
  "keywords": "DNSServer",
  "description": "Knot DNS Resolver включает в себя полное приложение для реализации кэш-резолвера, написанное на LuaJIT и C.",
  "articleBody": "Knot Resolver — это кэширующий DNS-резолвер, который можно использовать в крупных сетях, например, у интернет-провайдеров, а также настоятельно рекомендуется для использования на маршрутизаторах домашних сетей. Knot Resolver — это современная реализация решателя, разработанная для масштабируемости, надежности и гибкости. Конструкция разрешителя узлов отличается от других разрешителей. Его базовая архитектура небольшая и эффективная, а большинство его функций можно реализовать в виде дополнительных модулей, что ограничивает поверхность атаки и повышает производительность Knot Resolver.\n\nKnot DNS Resolver включает в себя полное приложение для реализации кэш-резолвера, написанное на LuaJIT и C. В Knot resolver есть много модулей, которые вы можете использовать, например, API-модули для расширений и многое другое. В целом существует три встроенных модуля: итератор, кэш, валидатор и множество других внешних модулей.\n\nВ модуле Lua кэш-преобразователь Knot является маршрутизируемым и общим, а быстрая привязка FFI делает его отличным для использования в процессе разрешения или для использования в вашей рекурсивной службе DNS. Это OpenResty DNS.\n\nСервер-резолвер DNS Knot использует иную стратегию масштабирования, чем другие рекурсивные DNS-серверы: он работает без потоковой передачи, не имеет общей архитектуры (за исключением общего кэша MVCC). Вы можете запускать и останавливать дополнительные узлы в зависимости от их загруженности без простоя.\n\nВ этой статье мы узнаем, как установить, настроить и использовать резолвер Knot на машине FreeBSD.\n\nA. Процесс установки решателя узлов\n\nКак и большинство приложений, работающих на FreeBSD, он использует PKG и порты для процесса установки. Аналогично с устройством разрешения узлов вы можете использовать либо систему PKG, либо систему портов. Хотя процесс установки с помощью системы портов занимает много времени, установленные библиотеки весьма полны. Поэтому мы рекомендуем вам использовать портовую систему для начала установки решателя узлов.\n\nВведите следующую команду, чтобы начать установку решателя узлов.\n\nroot@ns3:~ # cd /usr/ports/dns/knot-resolver\nroot@ns3:/usr/ports/dns/knot-resolver # make config\nroot@ns3:/usr/ports/dns/knot-resolver # make install clean\n\n\nВ команде «make config» появится меню опций, которые необходимо активировать. Если он активен, просто нажмите «ОК».\n\nПосле запуска команды «make install clean» система портов FreeBSD автоматически выполнит процесс установки. Дождитесь завершения процесса.\n\nОказывается, установить Knot resolver довольно просто, это может сделать каждый. Оказывается, процесс на этом не останавливается. Остается процесс настройки и порядок его использования.\n\nB. Процесс настройки преобразователя узлов\n\nКонфигурация — самый важный этап, вам предстоит изменять, добавлять и удалять скрипты, содержащиеся в файле конфигурации. По умолчанию каталогом резолвера Knot является «/usr/local/etc/knot-resolver», а его файл конфигурации называется «kresd.conf».\n\nОткройте файл «kresd.conf», отредактируйте скрипт и настройте его в соответствии со спецификациями вашего сервера FreeBSD. В качестве руководства вы можете использовать скрипт «kresd.conf», как показано ниже.\n\nnet.listen('192.168.5.2', 53, { kind = 'dns' })\n\n\n-- Load useful modules\nmodules = {\n\t'hints &gt; iterate',  -- Allow loading /etc/hosts or custom root hints\n\t'stats',            -- Track internal statistics\n\t'predict',          -- Prefetch expiring/frequent records\n}\n\ninternal_domains = policy.todnames({\n  'datainchi.com.'\n})\n\n-- The authoritative server runs on 127.0.0.1, port 2153\npolicy.add(policy.suffix(policy.STUB({'127.0.0.1@2153'}), internal_domains))\n\n-- Cache size\ncache.size = 100 * MB\n\npolicy.add(\n  policy.all(\n    policy.TLS_FORWARD({\n      {'8.8.8.8', hostname='dns.google' },\n      {'8.8.4.4', hostname='dns.google' },\n      {'1.1.1.1', hostname='cloudflare-dns.com' },\n      {'1.0.0.1', hostname='cloudflare-dns.com' },\n      {'9.9.9.9', hostname='dns.quad9.net' }\n    })\n))\n\n\nIP «192.168.5.2» — это локальный IP-адрес сервера FreeBSD, а IP «8.8.8.8,8.8.4.4,1.1.1.1,1.0.0.1,9.9.9.9» — это публичные IP-адреса DNS. Таким образом, резолвер Knot будет «перенаправлять» запросы на публичный DNS-IP. Локальное доменное имя в приведенном выше скрипте — «datainchi.com».\n\nПосле настройки файла «kresd.conf» перейдите к редактированию файла «/etc/resolv.conf». Введите приведенный ниже скрипт в файл.\n\nroot@ns3:~ # ee /etc/resolv.conf\n\ndomain datainchi.com\nnameserver 192.168.5.2\n\n\nC. Как использовать Knot Resolver\n\nНесмотря на то, что вы настроили файл «kresd.conf», резолвер Knot еще не готов к использованию, он установлен, но не запущен. Чтобы автоматически запустить резолвер Knot, откройте файл «/etc/rc.conf» и введите в него приведенный ниже скрипт.\n\nkresd_enable=\"YES\"\nkresd_config=\"/usr/local/etc/knot-resolver/kresd.conf\"\nkresd_user=\"kresd\"\nkresd_group=\"kresd\"\nkresd_rundir=\"/var/run/kresd\"\n\nkrescachegc_enable=\"YES\"\nkrescachegc_millis=\"1000\"\n\n\nПосле этого вы запускаете команду «chown», чтобы предоставить право собственности на файл.\n\nroot@ns3:~ # chown -R kresd:kresd /usr/local/etc/knot-resolver\n\n\nПерезагрузить (перезапустить) решатель узлов.\n\nroot@ns3:~ # service kresd restart\nroot@ns3:~ # service krescachegc restart\n\n\nТеперь ваш разрешитель узлов активен и готов к использованию. Попробуйте провести тестирование с помощью команды «dig».\n\nroot@ns3:~ # dig google.com\n\n; &lt;&lt;&gt;&gt; DiG 9.18.20 &lt;&lt;&gt;&gt; google.com\n;; global options: +cmd\n;; Got answer:\n;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 52479\n;; flags: qr rd ra; QUERY: 1, ANSWER: 6, AUTHORITY: 0, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1232\n;; QUESTION SECTION:\n;google.com.                    IN      A\n\n;; ANSWER SECTION:\ngoogle.com.             162     IN      A       142.251.10.113\ngoogle.com.             162     IN      A       142.251.10.138\ngoogle.com.             162     IN      A       142.251.10.139\ngoogle.com.             162     IN      A       142.251.10.100\ngoogle.com.             162     IN      A       142.251.10.101\ngoogle.com.             162     IN      A       142.251.10.102\n\n;; Query time: 94 msec\n;; SERVER: 192.168.5.2#53(192.168.5.2) (UDP)\n;; WHEN: Mon Jan 29 16:57:48 WIB 2024\n;; MSG SIZE  rcvd: 135\n\n\nОбратите внимание на синий скрипт. Вы успешно запустили резолвер Knot, поскольку на DNS-вызов google.com отвечает локальный IP-адрес вашего сервера FreeBSD. Повторите тест, используя команду ниже.\n\nroot@ns3:~ # dig oracle.com +trace\nroot@ns3:~ # dig -x 108.59.161.1\nroot@ns3:~ # nslookup facebook.com\nroot@ns3:~ # dig oracle.com +short\nroot@ns3:~ # dig NS +short unixwinbsd.site\n\n\nВ этой статье вы узнали, как установить пакет knot-resolver, настроить его и запустить на сервере FreeBSD. Вы можете изменить файл «kresd.conf», чтобы максимально эффективно использовать приложение Knot resolver. Содержание этой статьи ограничивается только базовой теорией решателя узлов, мы продолжим в следующем обсуждении, чтобы вы могли ощутить преимущества всех функций решателя узлов.\n\n",
  "datePublished": "2024-12-18 19:00:00 +0300",
  "dateModified": "2024-12-18 19:00:00 +0300",
  "author": {
    "@type": "Person",
"@id": "https://penaadventure.com/#profilepage",
"name": {"name":"UnixBSDShell's Blog","avatar":"auth/JHW500.jpg","avataralt":"Thank you for visiting our site. Have a nice day!.","bio":"penaadventure.com is an online learning platform that provides online tutorials and videos about unix, FreeBSD, OpenBSD and Linux. Not only that, penaadventure.com also presents a variety of topics, including software development, programming, web design, and more. This blog provides various online tutorials and videos for beginners and experienced professionals. This blog also provides a Q&A forum for users to ask questions and get help from other members.","location":"Moscow, Russia"},
"url": "https://penaadventure.com/about-us",
    "email": {"uri":null,"bitbucket":null,"codeberg":null,"codepen":null,"dribbble":null,"flickr":null,"facebook":null,"foursquare":null,"github":"datainchi@gmail.com","google_plus":null,"instagram":null,"keybase":null,"lastfm":null,"linkedin":"datainchi@gmail.com","mastodon":null,"pinterest":null,"soundcloud":null,"stackoverflow":null,"steemit":null,"steam":null,"tumblr":"datainchi@gmail.com","twitter":null,"vine":null,"weibo":null,"xing":null,"youtube":"datainchi@gmail.com"}
  },
"publisher": {
"@type": "EducationalOrganization",
"@id": "https://penaadventure.com/#organization"  },



  "mainEntityOfPage": {
    "@type": "WebPage",
"@id":"https://penaadventure.com/#webpage"
  },
  "image": {
    "@type": "ImageObject",
"@id":"https://penaadventure.com/#image"
  }
}

]}</script<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SKDSF4Y03H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SKDSF4Y03H');
</script>

    <!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(95806836, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/95806836" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
 
    <!-- Clarity tracking code for https://penaadventure.com/ -->
<script>
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "qrb63393nv");
</script>


<script type="text/javascript">
	atOptions = {
		'key' : '67fb5d6234d340006720e0f69ca5be7f',
		'format' : 'iframe',
		'height' : 90,
		'width' : 728,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//timdinosaur.com/67fb5d6234d340006720e0f69ca5be7f/invoke.js"></script>


<div id="main" role="main"><div class="sidebar sticky"><div itemscope itemtype="http://schema.org/Person">
  <div class="author__avatar"><img src="https://penaadventure.com/images/auth/JHW500.jpg" class="author__avatar" alt="Thank you for visiting our site. Have a nice day!."></div>
  <div class="author__content">
    <h3 class="author__name">UnixBSDShell's Blog</h3><p class="author__bio">penaadventure.com is an online learning platform that provides online tutorials and videos about unix, FreeBSD, OpenBSD and Linux. Not only that, penaadventure.com also presents a variety of topics, including software development, programming, web design, and more. This blog provides various online tutorials and videos for beginners and experienced professionals. This blog also provides a Q&A forum for users to ask questions and get help from other members.</p></div>
  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons"><li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Moscow, Russia</li></ul>
  </div>
</div></div><article class="page" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="headline" content="FreeBSD Knot Resolver — реализация DNS Caching Resolver"><meta itemprop="description" content="Knot DNS Resolver включает в себя полное приложение для реализации кэш-резолвера, написанное на LuaJIT и C."><meta itemprop="datePublished" content="2024-12-18"><div class="page__inner-wrap"><header><p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Posted:</strong> <time datetime="2024-12-18T19:00:00+03:00">2024-12-18</time> </p><h1 class="page__title" itemprop="headline">FreeBSD Knot Resolver — реализация DNS Caching Resolver
</h1></header><section class="page__content" itemprop="text">
        <p>Knot Resolver — это кэширующий DNS-резолвер, который можно использовать в крупных сетях, например, у интернет-провайдеров, а также настоятельно рекомендуется для использования на маршрутизаторах домашних сетей. Knot Resolver — это современная реализация решателя, разработанная для масштабируемости, надежности и гибкости. Конструкция разрешителя узлов отличается от других разрешителей. Его базовая архитектура небольшая и эффективная, а большинство его функций можно реализовать в виде дополнительных модулей, что ограничивает поверхность атаки и повышает производительность Knot Resolver.</p>

<p>Knot DNS Resolver включает в себя полное приложение для реализации кэш-резолвера, написанное на LuaJIT и C. В Knot resolver есть много модулей, которые вы можете использовать, например, API-модули для расширений и многое другое. В целом существует три встроенных модуля: итератор, кэш, валидатор и множество других внешних модулей.</p>

<p>В модуле Lua кэш-преобразователь Knot является маршрутизируемым и общим, а быстрая привязка FFI делает его отличным для использования в процессе разрешения или для использования в вашей рекурсивной службе DNS. Это OpenResty DNS.</p>

<p>Сервер-резолвер DNS Knot использует иную стратегию масштабирования, чем другие рекурсивные DNS-серверы: он работает без потоковой передачи, не имеет общей архитектуры (за исключением общего кэша MVCC). Вы можете запускать и останавливать дополнительные узлы в зависимости от их загруженности без простоя.</p>

<p>В этой статье мы узнаем, как установить, настроить и использовать резолвер Knot на машине FreeBSD.</p>

<h2 id="a-процесс-установки-решателя-узлов">A. Процесс установки решателя узлов</h2>

<p>Как и большинство приложений, работающих на FreeBSD, он использует PKG и порты для процесса установки. Аналогично с устройством разрешения узлов вы можете использовать либо систему PKG, либо систему портов. Хотя процесс установки с помощью системы портов занимает много времени, установленные библиотеки весьма полны. Поэтому мы рекомендуем вам использовать портовую систему для начала установки решателя узлов.</p>

<p>Введите следующую команду, чтобы начать установку решателя узлов.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns3:~ # cd /usr/ports/dns/knot-resolver
root@ns3:/usr/ports/dns/knot-resolver # make config
root@ns3:/usr/ports/dns/knot-resolver # make install clean
</code></pre></div></div>

<p>В команде «make config» появится меню опций, которые необходимо активировать. Если он активен, просто нажмите «ОК».</p>

<p>После запуска команды «make install clean» система портов FreeBSD автоматически выполнит процесс установки. Дождитесь завершения процесса.</p>

<p>Оказывается, установить Knot resolver довольно просто, это может сделать каждый. Оказывается, процесс на этом не останавливается. Остается процесс настройки и порядок его использования.</p>

<h2 id="b-процесс-настройки-преобразователя-узлов">B. Процесс настройки преобразователя узлов</h2>

<p>Конфигурация — самый важный этап, вам предстоит изменять, добавлять и удалять скрипты, содержащиеся в файле конфигурации. По умолчанию каталогом резолвера Knot является «/usr/local/etc/knot-resolver», а его файл конфигурации называется «kresd.conf».</p>

<p>Откройте файл «kresd.conf», отредактируйте скрипт и настройте его в соответствии со спецификациями вашего сервера FreeBSD. В качестве руководства вы можете использовать скрипт «kresd.conf», как показано ниже.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net.listen('192.168.5.2', 53, { kind = 'dns' })


-- Load useful modules
modules = {
	'hints &gt; iterate',  -- Allow loading /etc/hosts or custom root hints
	'stats',            -- Track internal statistics
	'predict',          -- Prefetch expiring/frequent records
}

internal_domains = policy.todnames({
  'datainchi.com.'
})

-- The authoritative server runs on 127.0.0.1, port 2153
policy.add(policy.suffix(policy.STUB({'127.0.0.1@2153'}), internal_domains))

-- Cache size
cache.size = 100 * MB

policy.add(
  policy.all(
    policy.TLS_FORWARD({
      {'8.8.8.8', hostname='dns.google' },
      {'8.8.4.4', hostname='dns.google' },
      {'1.1.1.1', hostname='cloudflare-dns.com' },
      {'1.0.0.1', hostname='cloudflare-dns.com' },
      {'9.9.9.9', hostname='dns.quad9.net' }
    })
))
</code></pre></div></div>

<p>IP «192.168.5.2» — это локальный IP-адрес сервера FreeBSD, а IP «8.8.8.8,8.8.4.4,1.1.1.1,1.0.0.1,9.9.9.9» — это публичные IP-адреса DNS. Таким образом, резолвер Knot будет «перенаправлять» запросы на публичный DNS-IP. Локальное доменное имя в приведенном выше скрипте — «datainchi.com».</p>

<p>После настройки файла «kresd.conf» перейдите к редактированию файла «/etc/resolv.conf». Введите приведенный ниже скрипт в файл.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns3:~ # ee /etc/resolv.conf

domain datainchi.com
nameserver 192.168.5.2
</code></pre></div></div>

<h2 id="c-как-использовать-knot-resolver">C. Как использовать Knot Resolver</h2>

<p>Несмотря на то, что вы настроили файл «kresd.conf», резолвер Knot еще не готов к использованию, он установлен, но не запущен. Чтобы автоматически запустить резолвер Knot, откройте файл «/etc/rc.conf» и введите в него приведенный ниже скрипт.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kresd_enable="YES"
kresd_config="/usr/local/etc/knot-resolver/kresd.conf"
kresd_user="kresd"
kresd_group="kresd"
kresd_rundir="/var/run/kresd"

krescachegc_enable="YES"
krescachegc_millis="1000"
</code></pre></div></div>

<p>После этого вы запускаете команду «chown», чтобы предоставить право собственности на файл.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns3:~ # chown -R kresd:kresd /usr/local/etc/knot-resolver
</code></pre></div></div>

<p>Перезагрузить (перезапустить) решатель узлов.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns3:~ # service kresd restart
root@ns3:~ # service krescachegc restart
</code></pre></div></div>

<p>Теперь ваш разрешитель узлов активен и готов к использованию. Попробуйте провести тестирование с помощью команды «dig».</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns3:~ # dig google.com

; &lt;&lt;&gt;&gt; DiG 9.18.20 &lt;&lt;&gt;&gt; google.com
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 52479
;; flags: qr rd ra; QUERY: 1, ANSWER: 6, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
;; QUESTION SECTION:
;google.com.                    IN      A

;; ANSWER SECTION:
google.com.             162     IN      A       142.251.10.113
google.com.             162     IN      A       142.251.10.138
google.com.             162     IN      A       142.251.10.139
google.com.             162     IN      A       142.251.10.100
google.com.             162     IN      A       142.251.10.101
google.com.             162     IN      A       142.251.10.102

;; Query time: 94 msec
;; SERVER: 192.168.5.2#53(192.168.5.2) (UDP)
;; WHEN: Mon Jan 29 16:57:48 WIB 2024
;; MSG SIZE  rcvd: 135
</code></pre></div></div>

<p>Обратите внимание на синий скрипт. Вы успешно запустили резолвер Knot, поскольку на DNS-вызов google.com отвечает локальный IP-адрес вашего сервера FreeBSD. Повторите тест, используя команду ниже.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@ns3:~ # dig oracle.com +trace
root@ns3:~ # dig -x 108.59.161.1
root@ns3:~ # nslookup facebook.com
root@ns3:~ # dig oracle.com +short
root@ns3:~ # dig NS +short unixwinbsd.site
</code></pre></div></div>

<p>В этой статье вы узнали, как установить пакет knot-resolver, настроить его и запустить на сервере FreeBSD. Вы можете изменить файл «kresd.conf», чтобы максимально эффективно использовать приложение Knot resolver. Содержание этой статьи ограничивается только базовой теорией решателя узлов, мы продолжим в следующем обсуждении, чтобы вы могли ощутить преимущества всех функций решателя узлов.</p>

</section>
      <footer class="page__meta"><script type="text/javascript">
	atOptions = {
		'key' : '9f0fbeed81ad3c9bfba81d92c5429c29',
		'format' : 'iframe',
		'height' : 60,
		'width' : 468,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//timdinosaur.com/9f0fbeed81ad3c9bfba81d92c5429c29/invoke.js"></script>


        <p class="page__date"><strong><i class="fa fa-fw fa-creative-commons" aria-hidden="true"></i> License: </strong> <a href="https://creativecommons.org/licenses/by/4.0/">By:</a> UnixBSDShell's Blog</p><p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Posted:</strong> <time datetime="2024-12-18T19:00:00+03:00">2024-12-18</time></p><p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords"><a href="https://penaadventure.com/tags/#dnsserver" class="page__taxonomy-item" rel="tag">DNSServer</a></span>
  </p><p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords"><a href="https://penaadventure.com/categories/#freebsd" class="page__taxonomy-item" rel="tag">FreeBSD</a><span class="sep">, </span><a href="https://penaadventure.com/categories/#ru" class="page__taxonomy-item" rel="tag">ru</a></span>
  </p></footer><nav class="pagination"><a href="https://penaadventure.com/ru/openbsd/2024/12/01/install-isc-dns-bind-on-openbsd/" class="pagination--pager" title="Установка DNS-сервера ISC Bind с использованием OpenBSD
">Previous</a><a href="https://penaadventure.com/ru/freebsd/2025/01/01/freebsd-cgi-bin-enable-mod-perl.apache/" class="pagination--pager" title="FreeBSD CGI BIN Включение mod PERL на Apache24
">Next</a></nav></div>
  </article></div><div class="page__footer">
      <footer><!-- start custom footer snippets -->
<!-- end custom footer snippets --><div class="page__footer-follow">
  <ul class="social-icons"><li><a href="https://x.com/iwanset96143401"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li><li><a href="feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Atom Feed</a></li>
    <li><a href="https://penaadventure.com/about/"><i class="fa fa-fw fa-user" aria-hidden="true"></i> About Us</a></li>
  </ul>
</div>
<div class="page__footer-copyright">&copy; 2025 UnixBSDShell. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://www.inchimediatama.org/" rel="dofollow">Minimal Mistakes</a>.</div>
</footer>
    </div><script src="https://penaadventure.com/assets/js/main.min.js"></script></body>
</html>